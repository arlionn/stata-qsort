
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   13.1   Copyright 1985-2013 StataCorp LP
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
                                      College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user Stata perpetual license:
       Serial number:  301306294610
         Licensed to:  Mauricio Caceres
                       mauricio.caceres.bravo@gmail.com

Notes:
      1.  Command line editing disabled
      2.  Stata running in batch mode

Note:  Your site can add messages to the introduction by editing the file
       stata.msg in the directory where Stata is installed.

. do tmp.do 

. version 13

. clear all

. set more off

. set varabbrev off

. * set seed 42
. set seed 1729

. set linesize 128

. 
. * sysuse auto,  clear
. * cap noi qsort foreign rep78 make, v b
. * cap noi qsort foreign rep78 make, v b
. * l
. 
. set rmsg on
r; t=0.00 23:04:32

. * clear
. * * set obs 300000
. * set obs 10000000
. * gen x = floor(rnormal())
. * gen y = rnormal()
. * qui ralpha rstr, l(3)
. * qui ralpha rst2, l(3)
. * gen double id2 = _n
. * gen byte dummy = 0
. * gen idx    = _n - 1
. * gen st_idx = _n - 1
. * save tmp, replace
. 
. * use /home/mauricio/code/stata-qsort-fresh/tmp.dta in 1/1000000, clear
. use /home/mauricio/code/stata-qsort-fresh/tmp.dta, clear
r; t=0.20 23:04:32

. cap noi qsort rstr x rst2 y, v b
plugin call qsort_plugin rstr x rst2 y id2 dummy idx st_idx, sort
Sort by 2 strings, 2 numeric
        Sort (1): Read in copy of data; 1.791 seconds.
        Sort (2): Sorted array; 8.398 seconds.
        Sort (3): Wrote back sorted data; 2.643 seconds.
r; t=12.87 23:04:45

. * sort rstr dummy x
. replace st_idx = _n - 1
(9999998 real changes made)
r; t=0.28 23:04:45

. sort idx
r; t=10.48 23:04:56

. sort rstr x rst2 y
r; t=16.65 23:05:12

. * cap noi qsort rstr dummy x
. assert st_idx == (_n - 1)
r; t=0.26 23:05:13

. 
end of do-file
r; t=0.00 23:05:13
